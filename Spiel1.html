<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wo wurde das Foto gemacht?</title>

<link rel="stylesheet" href="https://unpkg.com">
<script src="https://unpkg.com"></script>

<style>
body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 10px; }
h2 { margin-top: 10px; }
img { max-width: 95%; max-height: 300px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
#map { height: 400px; margin: 10px; border: 1px solid #ccc; }
button { padding: 12px 24px; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; }
button:hover { background-color: #0056b3; }
#ergebnis { font-size: 18px; margin-top: 10px; font-weight: bold; }
</style>
</head>

<body>

<h2>Wo wurde dieses Foto aufgenommen?</h2>
<img src="Autohaus.jpg" alt="Foto">
<div id="map"></div>
<button onclick="auswerten()">Antwort abgeben</button>
<p id="ergebnis"></p>

<script>
const richtigePosition = [50.68515069193782, 8.301681606586012];
let tipp = null;
let markerTipp;
let markerZiel;
let linie;

const map = L.map('map').setView(richtigePosition, 16);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

// Klick-Event f√ºr den Tipp
map.on('click', function(e) {
  // Wenn schon ausgewertet wurde, Klicks ignorieren (optional)
  if (markerZiel) return; 

  tipp = e.latlng;
  if (markerTipp) {
    map.removeLayer(markerTipp);
  }
  markerTipp = L.marker(tipp).addTo(map);
});

function haversine(start, ende) {
  const R = 6371000;
  const dLat = (ende.lat - start[0]) * Math.PI / 180;
  const dLon = (ende.lng - start[1]) * Math.PI / 180;
  const lat1 = start[0] * Math.PI / 180;
  const lat2 = ende.lat * Math.PI / 180;

  const a = Math.sin(dLat / 2) ** 2 +
            Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) ** 2;
  return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
}

function auswerten() {
  if (!tipp) {
    alert("Bitte zuerst auf die Karte tippen!");
    return;
  }

  // 1. Entfernung berechnen
  const entfernung = haversine(richtigePosition, tipp);
  document.getElementById("ergebnis").innerText = `Du warst ${entfernung} Meter vom richtigen Ort entfernt.`;

  // 2. Richtigen Ort markieren (Roter Marker)
  // Wir erstellen ein rotes Icon
  const redIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com',
    shadowUrl: 'https://cdnjs.cloudflare.com',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  if (markerZiel) map.removeLayer(markerZiel);
  markerZiel = L.marker(richtigePosition, {icon: redIcon}).addTo(map)
                .bindPopup("Das richtige Ziel!").openPopup();

  // 3. Gestrichelte Linie zeichnen
  if (linie) map.removeLayer(linie);
  const punktListe = [tipp, richtigePosition];
  linie = L.polyline(punktListe, {
    color: 'blue',
    weight: 3,
    opacity: 0.7,
    dashArray: '10, 10', // Erzeugt die gestrichelte Optik
    lineJoin: 'round'
  }).addTo(map);

  // 4. Ansicht anpassen, damit beide Punkte sichtbar sind
  const bounds = L.latLngBounds([tipp, richtigePosition]);
  map.fitBounds(bounds, {padding: [50, 50]});
}
</script>

</body>
</html>
