<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Wo wurde das Foto gemacht?</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 0;
  padding: 10px;
}
h2 {
  margin-top: 10px;
}
img {
  max-width: 95%;
  max-height: 300px;
  margin-bottom: 10px;
}
#map {
  height: 400px;
  margin: 10px;
}
button {
  padding: 12px 24px;
  font-size: 16px;
}
#ergebnis {
  font-size: 18px;
  margin-top: 10px;
}
</style>
</head>

<body>

<h2>Wo wurde dieses Foto aufgenommen?</h2>

<img src="Autohaus.jpg" alt="Foto">

<div id="map"></div>

<button onclick="auswerten()">Antwort abgeben</button>

<p id="ergebnis"></p>

<script>
const richtigePosition = [50.68515069193782, 8.301681606586012];
let tipp = null;
let zielMarker = null;
let linie = null;

const map = L.map('map').setView(richtigePosition, 16);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

let marker;
map.on('click', function(e) {
  // Verhindert neue Tipps nach der Auflösung
  if (zielMarker) return;

  tipp = e.latlng;
  if (marker) {
    map.removeLayer(marker);
  }
  marker = L.marker(tipp).addTo(map);
});

function haversine(start, ende) {
  const R = 6371000;
  const dLat = (ende.lat - start[0]) * Math.PI / 180;
  const dLon = (ende.lng - start[1]) * Math.PI / 180;
  const lat1 = start[0] * Math.PI / 180;
  const lat2 = ende.lat * Math.PI / 180;

  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(lat1) * Math.cos(lat2) *
    Math.sin(dLon / 2) ** 2;

  return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
}

function auswerten() {
  if (!tipp) {
    alert("Bitte zuerst auf die Karte tippen!");
    return;
  }

  const entfernung = haversine(richtigePosition, tipp);
  document.getElementById("ergebnis").innerText =
    `Du warst ${entfernung} Meter vom richtigen Ort entfernt.`;

  // 1. Roter Marker für das Ziel erstellen
  const redIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com',
    shadowUrl: 'https://cdnjs.cloudflare.com',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  // 1. Richtigen Ort als roten Kreis markieren (statt Bilddatei)
  if (zielMarker) map.removeLayer(zielMarker);
  zielMarker = L.circleMarker(richtigePosition, {
    radius: 10,
    fillColor: "#ff0000",
    color: "#000",
    weight: 2,
    opacity: 1,
    fillOpacity: 0.8
  }).addTo(map).bindPopup("Hier war es!").openPopup();

  // 2. Gestrichelte Linie zeichnen
  if (linie) map.removeLayer(linie);
  linie = L.polyline([tipp, richtigePosition], {
    color: 'red',
    weight: 3,
    dashArray: '10, 10'
  }).addTo(map);

  // 3. Karte zoomen, um beide Punkte zu zeigen
  const bounds = L.latLngBounds([tipp, richtigePosition]);
  map.fitBounds(bounds, {padding: [50, 50]});
}
</script>

</body>
</html>
